# terraform {
#   backend "http" {
#   }
#   required_providers {
#     kypo = {
#       source  = "vydrazde/kypo"
#     }
#   }
# }

terraform {
  required_version = ">= 0.13"
  backend "s3" {
    endpoint                    = "object-store.cloud.muni.cz"
    bucket                      = "tfstates"
    encrypt                     = true
    use_path_style              = true
    key                         = "main"
    region                      = "brno1"
    skip_credentials_validation = true
    skip_region_validation      = true
    workspace_key_prefix        = "main"
  }
  required_providers {
    kypo = {
      source = "vydrazde/kypo"
      version = "0.5.1"
    }
  }
}

variable "KYPO_ENDPOINT" {}
variable "CI_PROJECT_URL" {}
variable "CI_COMMIT_SHORT_SHA" {}

provider "kypo" {
  endpoint  = var.KYPO_ENDPOINT
}

module "sandbox" {
  source        = "gitlab.ics.muni.cz/muni-kypo-images/sandbox-ci/kypo"
  project_url   = var.CI_PROJECT_URL
  rev           = var.CI_COMMIT_SHORT_SHA
  kypo_endpoint = var.KYPO_ENDPOINT
}

output "pool_url" {
  value = module.sandbox.pool_url
}


# provider "openstack" {
#   auth_url    = "https://your-openstack-auth-url"
#   tenant_name = "your-tenant-name"
#   user_name   = "your-username"
#   password    = "your-password"
#   region      = "RegionOne"
# }

# resource "openstack_compute_instance_v2" "basic_instance" {
#   name            = "test-instance"
#   image_name      = "Ubuntu-22.04"
#   flavor_name     = "m1.small"
#   key_pair        = "my-keypair"
#   security_groups = ["default"]

#   network {
#     name = "private-network"
#   }
# }

# output "instance_ip" {
#   value = openstack_compute_instance_v2.basic_instance.access_ip_v4
# }


